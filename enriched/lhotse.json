{
  "name": "lhotse",
  "summary": "Data preparation for speech processing models training.",
  "language": "python",
  "tags": [
    "data",
    "math",
    "ml",
    "web"
  ],
  "chunks": [
    {
      "chunk_id": "lhotse::chunk_0",
      "text": "Lhotse\n\nLhotse is a Python library aiming to make multimodal (speech, audio, video, image, text) data preparation flexible and accessible to a wider community.\nAlongside [k2](https://github.com/k2-fsa/k2), it is a part of the next generation [Kaldi](https://github.com/kaldi-asr/kaldi) speech processing library.\n\nTutorial presentations and materials\n\nAbout\n\nMain goals (updated for 2025)\n\n- Scale to multimodal data pipelines including audio, text, image, and video modalities.\n- Provide state-of-the-art dataloading algorithms such as dataset blending and efficient on-the-fly bucketing.\n- Handle data randomization (or de-duplication) for distributed multi-node training.\n- Attract a wider community to multimodal processing tasks with a **Python-centric design**.\n- Provide **standard data preparation recipes** for commonly used corpora.\n- Flexible data preparation for model training with the notion of **audio/video cuts**.\n- Support for efficient sequential I/O data formats such as Lhotse Shar (similar to webdataset).\n\nTutorials\n\nWe offer the following tutorials available in `examples` directory:\n\nExamples of use\n\nCheck out the following links to see how Lhotse is being put to use:\n- [Icefall recipes](https://github.com/k2-fsa/icefall): where k2 and Lhotse meet.\n- Minimal ESPnet+Lhotse example: (https://colab.research.google.com/drive/1HKSYPsWx_HoCdrnLpaPdYj5zwlPsM3NH)\n\nMain ideas\n\nLike Kaldi, Lhotse provides standard data preparation recipes, but extends that with a seamless PyTorch integration\nthrough task-specific Dataset classes. The data and meta-data are represented in human-readable text manifests and\nexposed to the user through convenient Python classes.\n\nLhotse introduces the notion of audio cuts, designed to ease the training data construction with operations such as\nmixing, truncation and padding that are performed on-the-fly to minimize the amount of storage required. Data\naugmentation and feature extraction are supported both in pre-computed mode, with highly-compressed feature matrices\nstored on disk, and on-the-fly mode that computes the transformations upon request. Additionally, Lhotse introduces\nfeature-space cut mixing to make the best of both worlds.\n\nInstallation\n\nLhotse supports Python version 3.7 and later.\n\nPip\n\nLhotse is available on PyPI:\n\nTo install the latest, unreleased version, do:\n\nDevelopment installation\n\nFor development installation, you can fork/clone the GitHub repo and install with pip:\n\nThis is an editable installation (`-e` option), meaning that your changes to the source code are automatically\nreflected when importing lhotse (no re-install needed). The `[dev]` part means you're installing extra dependencies\nthat are used to run tests, build documentation or launch jupyter notebooks.\n\nEnvironment variables",
      "word_count": 371
    },
    {
      "chunk_id": "lhotse::chunk_1",
      "text": "Lhotse uses several environment variables to customize it's behavior. They are as follows:\n- `LHOTSE_REQUIRE_TORCHAUDIO` - when it's set and not any of `1|True|true|yes`, we'll not check for torchaudio being installed and remove it from the requirements. It will disable many functionalities of Lhotse but the basic capabilities will remain (including reading audio with `soundfile`).\n- `LHOTSE_AUDIO_DURATION_MISMATCH_TOLERANCE` - used when we load audio from a file and receive a different number of samples than declared in `Recording.num_samples`. This is sometimes necessary because different codecs (or even different versions of the same codec) may use different padding when decoding compressed audio. Typically values up to 0.1, or even 0.3 (second) are still reasonable, and anything beyond that indicates a serious issue.\n- `LHOTSE_AUDIO_BACKEND` - may be set to any of the values returned from CLI `lhotse list-audio-backends` to override the default behavior of trial-and-error and always use a specific audio backend.\n- `LHOTSE_RESAMPLING_BACKEND` - may be set to any of the value returned from CLI `lhotse list-resampling-backends` to override the default behaviour.\n- `LHOTSE_AUDIO_LOADING_EXCEPTION_VERBOSE` - when set to `1` we'll emit full exception stack traces when every available audio backend fails to load a given file (they might be very large).\n- `LHOTSE_DILL_ENABLED` - when it's set to `1|True|true|yes`, we will enable `dill`-based serialization of `CutSet` and `Sampler` across processes (it's disabled by default even when `dill` is installed).\n- `LHOTSE_LEGACY_OPUS_LOADING` - (`=1`) reverts to a legacy OPUS loading mechanism that triggered a new ffmpeg subprocess for each OPUS file.\n- `LHOTSE_PREPARING_RELEASE` - used internally by developers when releasing a new version of Lhotse.\n- `TORCHAUDIO_USE_BACKEND_DISPATCHER` - when set to `1` and torchaudio version is below 2.1, we'll enable the experimental ffmpeg backend of torchaudio.\n- `AIS_ENDPOINT` is read by AIStore client to determine AIStore endpoint URL. Required for AIStore dataloading.\n- `RANK`, `WORLD_SIZE`, `WORKER`, and `NUM_WORKERS` are internally used to inform Lhotse Shar dataloading subprocesses.\n- `READTHEDOCS` is internally used for documentation builds.\n- `LHOTSE_MSC_OVERRIDE_PROTOCOLS` - when set, it will override your input protocols before feeding to MSCIOBackend.  Useful when you don't want to change your existing url format but want to use MSCIOBackend.  For example, if you have `s3://s3-bucket/path/to/my/object` and `gs://gs-bucket/path/to/my/object`, you can set `LHOTSE_MSC_OVERRIDE_PROTOCOLS=s3,gs` to override the urls to `msc://s3-bucket/path/to/my/object` and `msc://gs-bucket/path/to/my/object`.\n- `LHOTSE_MSC_PROFILE` - when set, it will override the your bucket name before feeding to MSCIOBackend.  Useful when your msc profile is not the same as your bucket name.  For example, if you have `s3://s3-bucket/path/to/my/object`, you can set `LHOTSE_MSC_OVERRIDE_PROTOCOLS=s3` and `LHOTSE_MSC_PROFILE=msc-s3-profile` to override the url to `msc://msc-s3-profile/path/to/my/object`.\n- `LHOTSE_MSC_BACKEND_FORCED` - when set to `True`, forces Lhotse to use MSCIOBackend for all URLs. Use with caution as functionality may break if MSC does not support the provided URL format.\n\nOptional dependencies",
      "word_count": 454
    },
    {
      "chunk_id": "lhotse::chunk_2",
      "text": "**Other pip packages.** You can leverage optional features of Lhotse by installing the relevant supporting package:\n- `torchaudio` used to be a core dependency in Lhotse, but is now optional. Refer to [official PyTorch documentation for installation](https://pytorch.org/get-started/locally/).\n- `pip install lhotse[kaldi]` for a maximal feature set related to Kaldi compatibility. It includes libraries such as `kaldi_native_io` (a more efficient variant of `kaldi_io`) and `kaldifeat` that port some of Kaldi functionality into Python.\n- `pip install lhotse[orjson]` for up to 50% faster reading of JSONL manifests.\n- `pip install lhotse[webdataset]`. We support \"compiling\" your data into WebDataset tarball format for more effective IO. You can still interact with the data as if it was a regular lazy CutSet. To learn more, check out the following tutorial: (https://colab.research.google.com/github/lhotse-speech/lhotse/blob/master/examples/02-webdataset-integration.ipynb)\n- `pip install h5py` if you want to extract speech features and store them as HDF5 arrays.\n- `pip install dill`. When `dill` is installed, we'll use it to pickle CutSet that uses a lambda function in calls such as `.map` or `.filter`. This is helpful in PyTorch DataLoader with `num_jobs>0`. Without `dill`, depending on your environment, you'll see an exception or a hanging script.\n- `pip install aistore` to read manifests, tar fles, and other data from AIStore using AIStore-supported URLs (set `AIS_ENDPOINT` environment variable to activate it). See [AIStore documentation](https://aiatscale.org) for more details.\n- `pip install smart_open` to read and write manifests and data in any location supported by `smart_open` (e.g. cloud, http).\n- `pip install opensmile` for feature extraction using the OpenSmile toolkit's Python wrapper.\n- `pip install multi-storage-client` for read and write manifests and data in different storage backends. See [multi-storage-client](https://github.com/NVIDIA/multi-storage-client) for more details.\n\n**sph2pipe.** For reading older LDC SPHERE (.sph) audio files that are compressed with codecs unsupported by ffmpeg and sox, please run:\n\nIt will download it to `~/.lhotse/tools`, compile it, and auto-register in `PATH`. The program should be automatically detected and used by Lhotse.\n\nExamples\n\nWe have example recipes showing how to prepare data and load it in Python as a PyTorch `Dataset`.\nThey are located in the `examples` directory.\n\nA short snippet to show how Lhotse can make audio data preparation quick and easy:\n\nThe `VadDataset` will yield a batch with pairs of feature and supervision tensors such as the following - the speech\nstarts roughly at the first second (100 frames):",
      "word_count": 386
    }
  ]
}